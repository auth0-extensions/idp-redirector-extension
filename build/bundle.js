"use strict";
module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){const n=r(1),i=r(2),o=r(45),s=r(15);process.on("uncaughtException",e=>{s.verbose(e)});const a=n.createServer((e,t)=>(s.verbose("Starting Idp Redirector Extension - Version:","0.0.1"),i(e,t)));e.exports=((e,t,r)=>{t.x_wt&&t.x_wt.ectx&&t.x_wt.ectx.PUBLIC_WT_URL||!1||o.setValue("PUBLIC_WT_URL",n.urlHelpers.getWebtaskUrl(t)),a(e,t,r)})},function(e,t){e.exports=require("auth0-extension-express-tools@2.0.0")},function(e,t,r){(function(t){const n=r(3),i=(r(4),r(5)),o=r(6),s=r(7),a=r(8),l=r(9),c=r(10),u=r(11),d=r(50),f=r(52),h=r(54),p=r(45),g=r(15),{errorHandler:b}=r(56);e.exports=((e,r)=>{p.setProvider(e);const _=r?new c.WebtaskStorageContext(r,{force:1}):new c.FileStorageContext(n.join(t,"./data.json"),{mergeWrites:!0}),y=new i;y.use((e,t,r)=>{e.webtaskContext&&p.setProvider(c.configProvider.fromWebtaskContext(e.webtaskContext)),r()}),y.use(l.json({limit:"500kb"})),y.use(l.urlencoded({extended:!1}));const m=s({secret:a.expressJwtSecret({cache:!0,rateLimit:!0,jwksRequestsPerMinute:5,jwksUri:"https://"+p("AUTH0_DOMAIN")+"/.well-known/jwks.json"}),audience:p("EXTENSION_AUDIENCE"),issuer:"https://"+p("AUTH0_DOMAIN")+"/",algorithms:["RS256"]});return y.post("/testdonothing",async(e,t)=>{const r={iss:`https://${p("AUTH0_DOMAIN")}`,target_link_uri:e.body.state};t.redirect("https://nowhere.carlosmostek.com"+o.stringify(r))}),y.use("/api",m,u(_)),y.use("/meta",f()),y.use("/.extensions",d()),y.use(h(_)),y.use(b(g.verbose)),y})}).call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan@1.9.1")},function(e,t){e.exports=require("express@4.17.1")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("express-jwt@5.1.0")},function(e,t){e.exports=require("jwks-rsa@1.6.0")},function(e,t){e.exports=require("body-parser@1.12.4")},function(e,t){e.exports=require("auth0-extension-tools@1.4.0")},function(e,t,r){const{Router:n}=r(5),i=r(12),{URL:o}=r(13),{middlewares:s}=r(1),a=r(14),l=r(15),c=r(45),u=r(48),d=r(49);e.exports=(e=>{const t=new n,r=async(t,r)=>{const n=await e.read();t&&(n.errorPage=t),r&&(n.hostToPattern=r);try{await e.write(n),l.debug("Whitelist and errorPage updated"),delete global.storageData}catch(e){throw e}},f=(e,t,r)=>{const n=r.error_code;return r.error_description=`[${n}] ${r.error_description}`,e.status(t).json(r)},h=async(e,t)=>{const{error_page:{url:r}}=await e.auth0.getTenantSettings({fields:"error_page"});if(r){try{new o(r)}catch(e){return void f(t,400,{error:"bad_error_page",error_code:u.api.bad_error_page,error_description:`Bad error page ${r} because: ${e.message}`})}return r}f(t,400,{error:"no_error_page",error_code:u.api.missing_error_page,error_description:"Failed to fetch the error page from the tenant settings"})},p=()=>s.managementApiClient({domain:c("AUTH0_DOMAIN"),clientId:c("AUTH0_CLIENT_ID"),clientSecret:c("AUTH0_CLIENT_SECRET")}),g=i.string().min(10).max(1024),b=i.object().keys({clientName:i.string().min(1).max(200).required(),loginUrl:g.optional(),patterns:i.array().items(g.regex(/^[^*]*\*?$/).required()).min(1).required()}),_=i.array().items(b);return t.put("/errorPage",a(["update:patterns"]),p(),async(e,t)=>{try{delete e.query,delete e.body;const n=await h(e,t);if(!n)return;return await r(n),l.info({req:e,type:"redirector_successful_PUT_error_page",description:"Successful Error Page Update"}),t.status(204).send()}catch(r){return 409===r.code?f(t,409,{error:"update_conflict",error_code:u.api.update_conflict,error_description:"Can not override conflicting update, ensure you have the latest data and retry"}):(l.error({req:e,type:"failed_PUT",description:`Could not update storage because: ${r.message}`,error_code:u.internal.could_not_update_storage}),f(t,500,{error:"internal_error",error_code:u.internal.could_not_update_storage,error_description:"Internal Server Error"}))}}),t.put("/",a(["update:patterns"]),p(),async(e,t)=>{delete e.query;const n=e.body,s={};try{const{error:e}=await i.validate(n,_);if(e)return l.verbose(`Failed attempt to update whitelist: ${e.message}`),f(t,400,{error:"invalid_request",error_code:u.api.invalid_schema,error_description:e.message});n.forEach(e=>{if(e.loginUrl)try{new o(e.loginUrl)}catch(t){throw new Error(`loginUrl must be in the format of a URL: ${e.loginUrl}`)}e.patterns.forEach(t=>{const r=t.endsWith("*");let n=null;const i=r?t.substr(0,t.length-1):t;try{n=new o(i)}catch(e){throw l.debug(`Bad pattern: ${t}, ${i}`,e),new Error(`pattern must be in the format of a URL: ${t}`)}const a=`${n.protocol}//${n.host}`;if(i===a&&r)throw new Error(`pattern can not have a wildcard as part of the hostname: ${t}`);Object.prototype.hasOwnProperty.call(s,a)||(s[a]=[]);let c=s[a].find(t=>t.clientName===e.clientName);c||(c={clientName:e.clientName,patterns:[]},e.loginUrl&&(c.loginUrl=e.loginUrl.startsWith(a)?e.loginUrl.substr(a.length):e.loginUrl),s[a].push(c)),c.patterns.push(t.substr(a.length))})})}catch(e){return l.verbose(`Failed attempt to update whitelist: ${e.message}`),f(t,400,{error:"invalid_request",error_code:u.api.invalid_whitelist,error_description:e.message})}try{const i=await h(e,t);if(!i)return;return await r(i,s),e.query={},l.info({req:e,type:"redirector_successful_PUT",description:"Successful Whitelist Update"}),t.status(200).json(n)}catch(r){return 409===r.code?f(t,409,{error:"update_conflict",error_code:u.api.update_conflict,error_description:"Can not override conflicting update, ensure you have the latest data and retry"}):(l.error({req:e,type:"redirector_failed_PUT",description:`Could not update storage because: ${r.message}`,error_code:u.api.could_not_update_storage}),f(t,500,{error:"internal_error",error_code:u.internal.could_not_update_storage,error_description:"Internal Server Error"}))}}),t.get("/",a(["read:patterns"]),(t,r)=>{l.debug("reading data"),e.read().then(e=>{const t={};(e=e||{}).hostToPattern=e.hostToPattern||{},Object.keys(e.hostToPattern).forEach(r=>{e.hostToPattern[r].forEach(e=>{let n=t[e.clientName];n||(n={clientName:e.clientName,patterns:[]},e.loginUrl&&(n.loginUrl=d(r,e.loginUrl)),t[e.clientName]=n),e.patterns.forEach(e=>n.patterns.push(d(r,e)))})}),r.json(Object.keys(t).map(e=>t[e]))})}),t})},function(e,t){e.exports=require("joi@9.0.4")},function(e,t){e.exports=require("url")},function(e,t){e.exports=((e,t)=>{if(!Array.isArray(e))throw new Error("Parameter expectedScopes must be an array of strings representing the scopes for the endpoint(s)");return(r,n,i)=>{const o=r=>{if(t&&t.failWithError)return i({statusCode:403,error:"Forbidden",message:"Insufficient scope"});r.append("WWW-Authenticate",`Bearer scope="${e.join(" ")}", error="Insufficient scope"`),r.status(403).send("Insufficient scope")};if(0===e.length)return i();let s,a=[],l="scope";if(t&&null!=t.customScopeKey&&"string"==typeof t.customScopeKey&&(l=t.customScopeKey),!r.user)return o(n);if("string"==typeof r.user[l])a=r.user[l].split(" ");else{if(!Array.isArray(r.user[l]))return o(n);a=r.user[l]}return(s=t&&t.checkAllScopes?e.every(e=>a.includes(e)):e.some(e=>a.includes(e)))?i():o(n)}})},function(e,t,r){const n=r(16),i=r(17),o=r(46),s=n.createLogger({transports:[new n.transports.Console({level:"verbose",handleExceptions:!0,format:n.format.combine(new o({includeID:!1}),n.format.printf(({date:e,level:t,stack:r,description:n,...i})=>{const o=r?`\n${r}`:"";return`[${e}] ${t}: ${n} ${i&&Object.keys(i).length?`\n${JSON.stringify(i)}`:""} ${o}`}))}),new i({level:"info",handleExceptions:!0,format:new o({includeID:!0})})],exitOnError:!1});e.exports=s,e.exports.stream={write:e=>{s.verbose(e.replace(/\n$/,""))}}},function(e,t){e.exports=require("winston@3.1.0")},function(e,t,r){const n=r(18),i=r(44),o=r(45);e.exports=class extends n{constructor(e){super(e)}async log(e,t){try{const t=o("DATADOG_URL")||"https://http-intake.logs.datadoghq.com/v1/input",r=o("DATADOG_API_KEY");await i.post(t,e,{headers:{"DD-API-KEY":r},timeout:1e3})}catch(e){console.error(`Failed logging to datadog because: ${e.message}, ${e.response&&JSON.stringify(e.response.data)}`)}t()}logException(){}}},function(e,t,r){"use strict";const n=r(19),i=r(20),{LEVEL:o}=r(39),s=e.exports=function(e={}){i.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this.format=e.format,this.level=e.level,this.handleExceptions=e.handleExceptions,this.silent=e.silent,e.log&&(this.log=e.log),e.logv&&(this.logv=e.logv),e.close&&(this.close=e.close),this.once("pipe",e=>{this.levels=e.levels,this.parent=e}),this.once("unpipe",e=>{e===this.parent&&(this.parent=null,this.close&&this.close())})};n.inherits(s,i),s.prototype._write=function(e,t,r){if(this.silent||!0===e.exception&&!this.handleExceptions)return r(null);const n=this.level||this.parent&&this.parent.level;if(!n||this.levels[n]>=this.levels[e[o]]){if(e&&!this.format)return this.log(e,r);let t,n;try{n=this.format.transform(Object.assign({},e),this.format.options)}catch(e){t=e}if(t||!n){if(r(),t)throw t;return}return this.log(n,r)}return r(null)},s.prototype._writev=function(e,t){if(this.logv){const r=e.filter(this._accept,this);return r.length?this.logv(r,t):t(null)}for(let r=0;r<e.length;r++){if(!this._accept(e[r]))continue;if(e[r].chunk&&!this.format){this.log(e[r].chunk,e[r].callback);continue}let n,i;try{i=this.format.transform(Object.assign({},e[r].chunk),this.format.options)}catch(e){n=e}if(n||!i){if(e[r].callback(),n)throw t(null),n}else this.log(i,e[r].callback)}return t(null)},s.prototype._accept=function(e){const t=e.chunk;if(this.silent)return!1;const r=this.level||this.parent&&this.parent.level;return!(!0!==t.exception&&r&&!(this.levels[r]>=this.levels[t[o]])||!this.handleExceptions&&!0===t.exception)},s.prototype._nop=function(){}},function(e,t){e.exports=require("util")},function(e,t,r){var n=r(21),i=r(22);"disable"===Object({WARN_DB_SIZE:409600,MAX_MULTISELECT_USERS:5,MULTISELECT_DEBOUNCE_MS:250,PER_PAGE:10,NODE_ENV:"production",CLIENT_VERSION:"0.0.1"}).READABLE_STREAM?e.exports=n&&n.Writable||i:e.exports=i},function(e,t){e.exports=require("stream")},function(e,t,r){"use strict";var n=r(23);function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var o,s=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:n.nextTick;b.WritableState=g;var a=Object.create(r(24));a.inherits=r(25);var l={deprecate:r(27)},c=r(28),u=r(29).Buffer,d=global.Uint8Array||function(){};var f,h=r(31);function p(){}function g(e,t){o=o||r(32),e=e||{};var a=t instanceof o;this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var l=e.highWaterMark,c=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=l||0===l?l:a&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===e.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,o=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,o){--t.pendingcb,r?(n.nextTick(o,i),n.nextTick(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(o(i),e._writableState.errorEmitted=!0,e.emit("error",i),E(e,t))}(e,r,i,t,o);else{var a=w(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||m(e,r),i?s(y,e,r,a,o):y(e,r,a,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function b(e){if(o=o||r(32),!(f.call(b,this)||this instanceof o))return new b(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function _(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function y(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),E(e,t)}function m(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0,l=!0;r;)o[a]=r,r.isBuf||(l=!1),r=r.next,a+=1;o.allBuffers=l,_(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,u=r.encoding,d=r.callback;if(_(e,t,!1,t.objectMode?1:c.length,c,u,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function v(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),E(e,t)})}function E(e,t){var r=w(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,n.nextTick(v,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}a.inherits(b,c),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===b&&(e&&e._writableState instanceof g)}})):f=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,r){var i,o=this._writableState,s=!1,a=!o.objectMode&&(i=e,u.isBuffer(i)||i instanceof d);return a&&!u.isBuffer(e)&&(e=function(e){return u.from(e)}(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=p),o.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),n.nextTick(t,r)}(this,r):(a||function(e,t,r,i){var o=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),n.nextTick(i,s),o=!1),o}(this,o,e,r))&&(o.pendingcb++,s=function(e,t,r,n,i,o){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,a,n,i,o);return l}(this,o,a,e,t,r)),s},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||m(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,r){t.ending=!0,E(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,i,r)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=h.destroy,b.prototype._undestroy=h.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}},function(e,t,r){"use strict";"undefined"==typeof process||!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,r)});case 4:return process.nextTick(function(){e.call(null,t,r,n)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick(function(){e.apply(null,i)})}}}:e.exports=process},function(e,t){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=Buffer.isBuffer},function(e,t,r){try{var n=r(19);if("function"!=typeof n.inherits)throw"";e.exports=n.inherits}catch(t){e.exports=r(26)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},function(e,t,r){e.exports=r(19).deprecate},function(e,t,r){e.exports=r(21)},function(e,t,r){var n=r(30),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t){e.exports=require("buffer")},function(e,t,r){"use strict";var n=r(23);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){"use strict";var n=r(23),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=d;var o=Object.create(r(24));o.inherits=r(25);var s=r(33),a=r(22);o.inherits(d,s);for(var l=i(a.prototype),c=0;c<l.length;c++){var u=l[c];d.prototype[u]||(d.prototype[u]=a.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||n.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t,r){"use strict";var n=r(23);e.exports=y;var i,o=r(34);y.ReadableState=_;r(35).EventEmitter;var s=function(e,t){return e.listeners(t).length},a=r(28),l=r(29).Buffer,c=global.Uint8Array||function(){};var u=Object.create(r(24));u.inherits=r(25);var d=r(19),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var h,p=r(36),g=r(31);u.inherits(y,a);var b=["error","close","destroy","pause","resume"];function _(e,t){i=i||r(32),e=e||{};var n=t instanceof i;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var o=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=r(37).StringDecoder),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function y(e){if(i=i||r(32),!(this instanceof y))return new y(e);this._readableState=new _(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function m(e,t,r,n,i){var o,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,x(e)}(e,s)):(i||(o=function(e,t){var r;n=t,l.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),n?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?w(e,s,t,!1):k(e,s)):w(e,s,t,!1))):n||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function w(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&x(e)),k(e,t)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),y.prototype.destroy=g.destroy,y.prototype._undestroy=g.undestroy,y.prototype._destroy=function(e,t){this.push(null),t(e)},y.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=l.from(e,t),t=""),r=!0),m(this,e,t,!1,r)},y.prototype.unshift=function(e){return m(this,e,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(e){return h||(h=r(37).StringDecoder),this._readableState.decoder=new h(e),this._readableState.encoding=e,this};var v=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=v?e=v:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function x(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n.nextTick(S,e):S(e))}function S(e){f("emit readable"),e.emit("readable"),R(e)}function k(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function C(e){f("readable nexttick read 0"),e.read(0)}function I(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function N(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=l.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function U(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,n.nextTick(A,t,e))}function A(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function q(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}y.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):x(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&U(this),null;var n,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(r,t))),null===(n=e>0?N(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&U(this)),null!==n&&this.emit("data",n),n},y.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,f("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?c:y;function l(t,n){f("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,f("cleanup"),e.removeListener("close",b),e.removeListener("finish",_),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",l),r.removeListener("end",c),r.removeListener("end",y),r.removeListener("data",p),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function c(){f("onend"),e.end()}i.endEmitted?n.nextTick(a):r.once("end",a),e.on("unpipe",l);var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,R(e))}}(r);e.on("drain",u);var d=!1;var h=!1;function p(t){f("ondata"),h=!1,!1!==e.write(t)||h||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==q(i.pipes,e))&&!d&&(f("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,h=!0),r.pause())}function g(t){f("onerror",t),y(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function b(){e.removeListener("finish",_),y()}function _(){f("onfinish"),e.removeListener("close",b),y()}function y(){f("unpipe"),r.unpipe(e)}return r.on("data",p),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",b),e.once("finish",_),e.emit("pipe",r),i.flowing||(f("pipe resume"),r.resume()),e},y.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=q(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},y.prototype.on=function(e,t){var r=a.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&x(this):n.nextTick(C,this))}return r},y.prototype.addListener=y.prototype.on,y.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(I,e,t))}(this,e)),this},y.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(f("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&void 0!==i)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<b.length;o++)e.on(b[o],this.emit.bind(this,b[o]));return this._read=function(t){f("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),y._fromList=N},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";var n=r(29).Buffer,i=r(19);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,o=n.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=o,i=a,t.copy(r,i),a+=s.data.length,s=s.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t,r){"use strict";var n=r(38).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=f,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){var n=r(30),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"LEVEL",{value:Symbol.for("level")}),Object.defineProperty(t,"MESSAGE",{value:Symbol.for("message")}),Object.defineProperty(t,"SPLAT",{value:Symbol.for("splat")}),Object.defineProperty(t,"configs",{value:r(40)})},function(e,t,r){"use strict";Object.defineProperty(t,"cli",{value:r(41)}),Object.defineProperty(t,"npm",{value:r(42)}),Object.defineProperty(t,"syslog",{value:r(43)})},function(e,t,r){"use strict";t.levels={error:0,warn:1,help:2,data:3,info:4,debug:5,prompt:6,verbose:7,input:8,silly:9},t.colors={error:"red",warn:"yellow",help:"cyan",data:"grey",info:"green",debug:"blue",prompt:"grey",verbose:"cyan",input:"grey",silly:"magenta"}},function(e,t,r){"use strict";t.levels={error:0,warn:1,info:2,http:3,verbose:4,debug:5,silly:6},t.colors={error:"red",warn:"yellow",info:"green",http:"green",verbose:"cyan",debug:"blue",silly:"magenta"}},function(e,t,r){"use strict";t.levels={emerg:0,alert:1,crit:2,error:3,warning:4,notice:5,info:6,debug:7},t.colors={emerg:"red",alert:"yellow",crit:"red",error:"red",warning:"red",notice:"yellow",info:"green",debug:"blue"}},function(e,t){e.exports=require("axios@0.19.2")},function(e,t,r){e.exports=r(10).config()},function(e,t,r){const n=r(47),i=r(45),o=(e,t)=>{if(e[t]){const r=JSON.parse(JSON.stringify(e[t]));return r.code&&(r.code="******"),r}return null};e.exports=class{constructor(e){this.includeID=e.includeID}transform(e){let t=Object.assign({},e);if("string"!=typeof t.message&&(t.message=Object.assign({},e.message)),t.date=(new Date).toISOString(),t.message.req){t.hostname=i("PUBLIC_WT_URL"),t.client_id=i("AUTH0_CLIENT_ID"),t.message.req.headers&&(t.message.req.headers["x-forwarded-for"]&&(t.ip=t.message.req.headers["x-forwarded-for"]),t.message.req.headers["user-agent"]&&(t.user_agent=t.message.req.headers["user-agent"])),!t.ip&&t.message.req.connection&&t.message.req.connection.remoteAddress&&(t.ip=t.message.req.connection.remoteAddress);const e=o(t.message.req,"query"),r=o(t.message.req,"body");(e||r)&&(t.details=JSON.parse(JSON.stringify(t.message.details||{})),t.details.request={},e&&(t.details.request.query=e),r&&(t.details.request.body=r)),t.message.req.user&&t.message.req.user.sub&&(t.user_id=t.message.req.user.sub),t.message.req.user_error&&(t.user_error=t.message.req.user_error),delete t.message.req}return this.includeID&&(t._id=n.v4(),t.log_id=t._id),"string"==typeof t.message?t.description=t.message:t={...t,...t.message},delete t.message,t}}},function(e,t){e.exports=require("uuid@8.0.0")},function(e,t){e.exports={api:{update_conflict:"AE001",invalid_schema:"AE002",invalid_whitelist:"AE003",bad_error_page:"AE004",missing_error_page:"AE005"},code_exchange:{forbidden:"CE001",missing_id_token:"CE002",internal:"CE003"},internal:{error_page_not_configured:"IE001",could_not_update_storage:"IE002"},redirect:{missing_state:"RE001",state_invalid_host:"RE002",state_did_not_match_pattern:"RE003",state_must_be_url:"RE004",user_exchange_failed:"RE005",forwarding_errors:"RE006",bad_id_token:"RE007"}}},function(e,t,r){const{URL:n}=r(13);e.exports=((e,t)=>{try{return new n(t),t}catch(r){return e+t}})},function(e,t,r){const{Router:n}=r(5),{middlewares:i}=r(1),o=r(45),s=r(15),a=r(51);e.exports=(()=>{const e=i.validateHookToken(o("AUTH0_DOMAIN"),o("WT_URL"),o("EXTENSION_SECRET")),t=n();return t.use(i.managementApiClient({domain:o("AUTH0_DOMAIN"),clientId:o("AUTH0_CLIENT_ID"),clientSecret:o("AUTH0_CLIENT_SECRET")})),t.use("/on-uninstall",e("/.extensions/on-uninstall")),t.delete("/on-uninstall",async(e,t)=>{s.debug("Uninstall running version 0.0.1 ...");try{const r=e.auth0.getClientGrants({audience:o("EXTENSION_AUDIENCE")}),n=e.auth0.getRules({fields:"name,id"}),[i,a]=await Promise.all([r,n]),l=a.find(e=>"DO-NOT-MODIFY Deny User Based Access for IdP Redirector API"===e.name),[c]=i,u=l?e.auth0.deleteRule({id:l.id}):Promise.resolve(),d=e.auth0.deleteClient({client_id:o("AUTH0_CLIENT_ID")}),f=c&&c.client_id?e.auth0.deleteClient({client_id:c.client_id}):Promise.resolve(),h=e.auth0.deleteResourceServer({id:encodeURIComponent(o("EXTENSION_AUDIENCE"))});await Promise.all([d,f,h,u]),s.debug(`Deleted Extension Client: ${o("AUTH0_CLIENT_ID")}`),c&&s.debug(`Deleted Deployment Client: ${c.client_id}`),s.debug(`Deleted API: ${o("EXTENSION_AUDIENCE")}`),l&&s.debug(`Deleted Rule: ${l.name}`)}catch(e){s.debug(`Error deleting extension resources: ${e.message?e.message:""}`),s.verbose(e)}finally{t.sendStatus(204)}}),t.use("/on-install",e("/.extensions/on-install")),t.post("/on-install",async(e,t)=>{s.verbose("Install running...");const r=[{value:"update:patterns",description:"Update the whitelist patterns"},{value:"read:patterns",description:"Read the whitelist patterns"}],n=e.auth0.createResourceServer({identifier:o("EXTENSION_AUDIENCE"),name:"idp-redirector-api",scopes:r}),i=e.auth0.createClient({name:o("DEPLOYMENT_CLIENT_NAME"),app_type:"non_interactive",grant_types:["client_credentials"]}),l=e.auth0.updateClient({client_id:o("AUTH0_CLIENT_ID")},{app_type:"regular_web",grant_types:["implicit","client_credentials"],callbacks:[o("PUBLIC_WT_URL")]}),c=e.auth0.createRule({enabled:!0,script:a.replace("##IDP_REDIRECTOR_AUDIENCE##",o("EXTENSION_AUDIENCE")),name:"DO-NOT-MODIFY Deny User Based Access for IdP Redirector API"});try{const[a,u,,d]=await Promise.all([i,n,l,c]),f=await e.auth0.createClientGrant({client_id:a.client_id,audience:o("EXTENSION_AUDIENCE"),scope:r.map(e=>e.value)});return s.verbose(`Created Client: ${a.client_id}`),s.verbose(`Created API: ${u.identifier}`),s.verbose(`Created Grant: ${f.id}`),s.verbose(`Created Rule: ${d.name}`),t.sendStatus(204)}catch(e){return s.debug(`Error creating extension resources: ${e.message?e.message:""}`),s.verbose(e),t.status(500).json({error:"failed_install",error_description:"Could not create required extension resources"})}}),t})},function(e,t){e.exports=' \nfunction denyIdPRedirectorAudienceForUserFlows(user, context, callback) {\n  const IDP_REDIRECTOR_AUDIENCE = "##IDP_REDIRECTOR_AUDIENCE##";\n  const requestedAudience =\n    (context.request.body && context.request.body.audience) ||\n    (context.request.query && context.request.query.audience);\n\n  if (requestedAudience === IDP_REDIRECTOR_AUDIENCE) {\n    return callback(\n      new UnauthorizedError(\n        `${IDP_REDIRECTOR_AUDIENCE} is not allowed for user oriented operations`\n      )\n    );\n  }\n\n  callback(null, user, context);\n}'},function(e,t,r){const n=r(5),i=r(53);e.exports=(()=>{const e=new n.Router;return e.get("/",(e,t)=>{t.status(200).send(i)}),e})},function(e){e.exports={title:"IdP Redirector Extension",name:"idp-redirector",version:"0.0.1",author:"auth0",useHashName:!1,description:"This extension implements customer specific IdP redirection features.",type:"application",category:"end_user",logoUrl:"https://res-1.cloudinary.com/crunchbase-production/image/upload/c_lpad,h_120,w_120,f_auto,b_white,q_auto:eco/v1397191966/68aa3a98f81f5e09a3afb00a73461434.png",initialUrlPath:"/",docsUrl:"https://auth0.com/docs",repository:"https://github.com/auth0-customers/idp-redirector.git",keywords:["auth0","extension"],auth0:{createClient:!0,onUninstallPath:"/.extensions/on-uninstall",onInstallPath:"/.extensions/on-install",scopes:"create:clients read:clients update:clients delete:clients create:resource_servers read:resource_servers update:resource_servers delete:resource_servers read:connections create:client_grants read:client_grants create:rules read:rules delete:rules read:tenant_settings"},secrets:{EXTENSION_AUDIENCE:{description:"The audience for the extension API",default:"urn:idp-redirector-api"},DEPLOYMENT_CLIENT_NAME:{description:"The name of the CI/CD client",default:"IDP Redirector CI/CD Client"},DATADOG_API_KEY:{description:"API key for DataDog",required:!0,type:"password"},DATADOG_URL:{description:"The datadog URL for sending the logs",example:"https://http-intake.logs.datadoghq.com/v1/input"}}}},function(e,t,r){const n=r(55),{Router:i}=r(5),{URL:o}=r(13),s=r(6),a=r(15),l=r(45),c=r(48),u=r(49);e.exports=(e=>{const t=new i;t.use(async(t,r,n)=>{let i=global.storageData;i&&i.hostToPattern&&i.errorPage||(a.verbose("Fetching storage data from webtask storage"),i=await e.read(),global.storageData=i),t.hostToPattern=i.hostToPattern||{},t.errorPage=i.errorPage,n()});const r=(e,t,r)=>{let n=r.code;n&&(r.error_description=`[${n}] ${r.error_description}`,delete r.code);const i={client_id:"",connection:"",lang:e.headers["accept-language"],...r};if(a.error({type:"redirector_failed_redirect",description:"Failed to redirect after IdP Initiated Login",error_code:n,details:{response:{query:i}},req:e}),!e.errorPage)return a.error({type:"redirector_internal_error",error_code:c.internal.error_page_not_configured,description:"Error page has not been configured",req:e}),t.status(500).send(JSON.stringify({error:"internal_error",error_description:`[${c.internal.error_page_not_configured}] Internal Server Error`},null,2));const l=new o(e.errorPage);return l.search=s.stringify(i),t.redirect(l.href)},d=async(e,t,r)=>{if(e.body&&e.body.id_token)try{const t=e.body.id_token;e.user=n.decode(t)}catch(t){a.verbose(`Error attempting to decode ID token: ${t.message}`),e.user_error=c.redirect.bad_id_token}r()};return t.post("/testloadstorageonly",async(e,t)=>{const r={iss:`https://${l("AUTH0_DOMAIN")}`,target_link_uri:e.body.state};t.redirect("https://nowhere.carlosmostek.com"+s.stringify(r))}),t.post("/testloadstorageandidtoken",d,async(e,t)=>{const r={iss:`https://${l("AUTH0_DOMAIN")}`,target_link_uri:e.body.state};t.redirect("https://nowhere.carlosmostek.com"+s.stringify(r))}),t.post("/testloadstorageandidtokenandlog",d,async(e,t)=>{const r={iss:`https://${l("AUTH0_DOMAIN")}`,target_link_uri:e.body.state};a.info({type:"redirector_successful_redirect",description:"Successful Redirect",req:e}),t.redirect("https://nowhere.carlosmostek.com"+s.stringify(r))}),t.post("/",d,async(e,t)=>{e.body=e.body||{};const n=e.body.state;if(!n)return r(e,t,{code:c.redirect.missing_state,error:"invalid_request",error_description:"Missing state parameter"});let i=n,d=!1;try{const s=new o(n),a=`${s.protocol}//${s.host}`,l=e.hostToPattern[a];if(!l)return r(e,t,{code:c.redirect.state_invalid_host,error:"invalid_host",error_description:`Invalid host in state url: ${n}`});if(l.forEach(e=>{d||e.patterns.forEach(t=>{if(d)return;const r=t.endsWith("*"),i=r?t.substr(0,t.length-1):t,o=u(a,i);(r&&n.startsWith(o)||n===o)&&(d={domain:a,clientName:e.clientName,pattern:o+(r?"*":"")},e.loginUrl&&(d.loginUrl=u(a,e.loginUrl)))})}),!d)return r(e,t,{code:c.redirect.state_did_not_match_pattern,error:"invalid_request",error_description:`state must match a valid whitelist pattern: ${n}`});i=d.loginUrl?d.loginUrl:n}catch(i){return r(e,t,{code:c.redirect.state_must_be_url,error:"invalid_request",error_description:`state must be in the form of a URL: ${n}`})}let f={};e.body.error||e.body.error_description?f={error:e.body.error,error_description:e.body.error_description}:e.user_error&&(f={error:"invalid_request",error_description:`[${e.user_error}] Invalid User Code`});const h=new o(i),p={...s.parse(h.search),iss:`https://${l("AUTH0_DOMAIN")}`,target_link_uri:n,...f};h.search=s.stringify(p);const g={matched:d,response:{location:i,query:p}};return f.error&&!e.user_error?a.error({type:"redirector_forward_error",description:"Error Redirect",error_code:c.redirect.forwarding_errors,req:e,details:g}):e.user_error?a.error({type:"redirector_bad_user_exchange",description:"Error Redirect",error_code:c.redirect.user_exchange_failed,req:e,details:g}):a.info({type:"redirector_successful_redirect",description:"Successful Redirect",req:e,details:g}),t.redirect(h.href)}),t})},function(e,t){e.exports=require("jsonwebtoken@8.5.0")},function(e,t,r){e.exports={errorHandler:r(57)}},function(e,t,r){e.exports=(e=>(t,r,n,i)=>(e&&e(t),t&&(t.status||t.statusCode)?(n.status(t.status||t.statusCode),n.json({error:t.code||t.name,message:t.message||t.name})):(n.status(500),n.json({error:"InternalServerError",message:t.message||t.name}))))}]);